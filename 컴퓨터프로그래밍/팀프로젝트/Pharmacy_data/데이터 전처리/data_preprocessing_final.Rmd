---
title: "data_preprocessing_final"
output: word_document
---
### 데이터 파일 읽기
```{r}
df1 <- read.csv("seoul_pharmacy.csv")
View(df1)
class(df1) # 읽어온 데이터 파일은 data.frame 형태임
```
### 주소에서 구만 선택하여 행정구 컬럼으로 저장하기
```{r}
addr_li<- strsplit(df1$주소,split = " ")
# 문자열 슬라이싱 결과 list 형태로 저장됨 
# -> 각각의 벡터 전체에서 두 번째 내부 원소가 구이다.
```

* 리스트의 경우 구성 벡터의 내부 원소에 접근하려면 [[]]을 이용하여야 함
* 각 벡터의 두 번째 요소에 접근하는 함수를 만들고, 각 행마다(각 벡터마다) 적용
```{r}
# 두 번째 요소에 접근하는 함수 정의
search <- function(x){ # 두 번째 요소 찾기
  x[2]
}

# 각 행(각 벡터)마다 적용
df1$행정구 <- sapply(addr_li,search)
View(df1)
```

### 필요힌 정보만을 가져오기
* 가져와야 할 컬럼의 수 > 없앨 컬럼의 수
* 기존의 data frame에서 약국ID, 우편번호1/2, 병원경도/위도, 작업일시 컬럼 삭제
```{r}
# 불필요한 컬럼 삭제
df2 <- df1[,-c(1,21:25)]
View(df2)

# 보기 좋은 형태로 컬럼 순서 변경하기
df3 <- df2[,c(2,1,3,20,12,4,13,5,14,6,15,7,16,8,17,9,18,10,19,11)]
View(df3)

# 컬럼명 변경하기
new_colname <- c("약국명","주소","대표전화","행정구","시작(월)","마감(월)","시작(화)","마감(화)","시작(수)","마감(수)","시작(목)","마감(목)","시작(금)","마감(금)","시작(토)","마감(토)","시작(일)","마감(일)","시작(공휴일)","마감(공휴일)")
colnames(df3) <- new_colname
View(df3)
```

### 새로운 정보 저장을 위한 컬럼 생성
1. 일요일 운영 여부
* 권지수/ 이수미 학생의 방식을 활용하였습니다.
```{r}
df3$일요일 <- (!is.na(df3$`시작(일)`)) & (!is.na(df3$`마감(일)`))
View(df3)
```

2. 공휴일 운영 여부
* 권지수/ 이수미 학생의 방식을 활용하였습니다.
```{r}
df3$공휴일 <- (!is.na(df3$`시작(공휴일)`)) & (!is.na(df3$`마감(공휴일)`))
View(df3)
```

3. 야간 운영 여부
* 마감 시간에서 새벽 시간대를 표시하는 형식이 통일되어있지 않음
* 새벽 3시의 경우 2700(2400 + 300)으로 표시하는 형식 채택
* 데이터 상의 모든 약국들이 530 <= 운영시간 <= 2929(2400 + 529)이도록 데이터 가공

a) 24시간 운영하는 약국
* 찾아내는 방법
  -> (마감) – (시작) = 0 or 2400
* 해당 약국들의 경우, 진료시작시간을 530으로, 진료마감시간을 2929으로 통일시켜주기


```{r}
# 함수로 안묶여요....5시간째 헤매다 그냥 포기했슴미다...ㅇ-<-<
# 전 어려분들을 믿어요..ㅎㅅㅎ...제발 누가 함수로 묶어주세요 ^3^

# open_24 <- function(df,start,end){
#   n = nrow(df)
#   for(i in 1:n){
#     open = start[i]
#     close = end[i]
#     if(((close - open) == 0) | ((close - open) == 2400)){
#       df[]
#     }
#   }
#   return(df)
# }
```

```{r}
# df3 <- open_24(df3,df3$`시작(월)`,df3$`마감(월)`)
# View(df3)
```

```{r}
# 월요일
open_mon <- ifelse(((df3$`마감(월)` - df3$`시작(월)`) == 0 |(df3$`마감(월)` - df3$`시작(월)`) == 2400),530,df3$`시작(월)`)
close_mon <- ifelse(((df3$`마감(월)` - df3$`시작(월)`) == 0 |(df3$`마감(월)` - df3$`시작(월)`) == 2400),2929,df3$`마감(월)`)
df3$`시작(월)` <- open_mon
df3$`마감(월)` <- close_mon
View(df3)
```

```{r}
# 화요일
open_tue <- ifelse(((df3$`마감(화)` - df3$`시작(화)`) == 0 |(df3$`마감(화)` - df3$`시작(화)`) == 2400),530,df3$`시작(화)`)
close_tue <- ifelse(((df3$`마감(화)` - df3$`시작(화)`) == 0 |(df3$`마감(화)` - df3$`시작(화)`) == 2400),2929,df3$`마감(화)`)
df3$`시작(화)` <- open_tue
df3$`마감(화)` <- close_tue
View(df3)
```

```{r}
# 수요일
open_wed <- ifelse(((df3$`마감(수)` - df3$`시작(수)`) == 0 |(df3$`마감(수)` - df3$`시작(수)`) == 2400),530,df3$`시작(수)`)
close_wed <- ifelse(((df3$`마감(수)` - df3$`시작(수)`) == 0 |(df3$`마감(수)` - df3$`시작(수)`) == 2400),2929,df3$`마감(수)`)
df3$`시작(수)` <- open_wed
df3$`마감(수)` <- close_wed
View(df3)
```

```{r}
# 목요일
open_thu <- ifelse(((df3$`마감(목)` - df3$`시작(목)`) == 0 |(df3$`마감(목)` - df3$`시작(목)`) == 2400),530,df3$`시작(목)`)
close_thu <- ifelse(((df3$`마감(목)` - df3$`시작(목)`) == 0 |(df3$`마감(목)` - df3$`시작(목)`) == 2400),2929,df3$`마감(목)`)
df3$`시작(목)` <- open_thu
df3$`마감(목)` <- close_thu
View(df3)
```

```{r}
# 금요일
open_fri <- ifelse(((df3$`마감(금)` - df3$`시작(금)`) == 0 |(df3$`마감(금)` - df3$`시작(금)`) == 2400),530,df3$`시작(금)`)
close_fri <- ifelse(((df3$`마감(금)` - df3$`시작(금)`) == 0 |(df3$`마감(금)` - df3$`시작(금)`) == 2400),2929,df3$`마감(금)`)
df3$`시작(금)` <- open_fri
df3$`마감(금)` <- close_fri
View(df3)
```

```{r}
# 토요일
open_sat <- ifelse(((df3$`마감(토)` - df3$`시작(토)`) == 0 |(df3$`마감(토)` - df3$`시작(토)`) == 2400),530,df3$`시작(토)`)
close_sat <- ifelse(((df3$`마감(토)` - df3$`시작(토)`) == 0 |(df3$`마감(토)` - df3$`시작(토)`) == 2400),2929,df3$`마감(토)`)
df3$`시작(토)` <- open_sat
df3$`마감(토)` <- close_sat
View(df3)
```

```{r}
# 일요일
open_sun <- ifelse(((df3$`마감(일)` - df3$`시작(일)`) == 0 |(df3$`마감(일)` - df3$`시작(일)`) == 2400),530,df3$`시작(일)`)
close_sun <- ifelse(((df3$`마감(일)` - df3$`시작(일)`) == 0 |(df3$`마감(일)` - df3$`시작(일)`) == 2400),2929,df3$`마감(일)`)
df3$`시작(일)` <- open_sun
df3$`마감(일)` <- close_sun
View(df3)
```

```{r}
# 공휴일
open_etc <- ifelse(((df3$`마감(공휴일)` - df3$`시작(공휴일)`) == 0 |(df3$`마감(공휴일)` - df3$`시작(공휴일)`) == 2400),530,df3$`시작(공휴일)`)
close_etc <- ifelse(((df3$`마감(공휴일)` - df3$`시작(공휴일)`) == 0 |(df3$`마감(공휴일)` - df3$`시작(공휴일)`) == 2400),2929,df3$`마감(공휴일)`)
df3$`시작(공휴일)` <- open_etc
df3$`마감(공휴일)` <- close_etc
View(df3)
```

b) 새벽 운영을 하는 약국 처리해주기
```{r}
df3$`마감(월)` <- ifelse(((df3$`마감(월)` >= 0)&(df3$`마감(월)` < 530)),df3$`마감(월)` + 2400,df3$`마감(월)`)
df3$`마감(화)` <- ifelse(((df3$`마감(화)` >= 0)&(df3$`마감(화)` < 530)),df3$`마감(화)`+2400,df3$`마감(화)`)
df3$`마감(수)` <- ifelse(((df3$`마감(수)` >= 0)&(df3$`마감(수)` < 530)),df3$`마감(수)`+2400,df3$`마감(수)`)
df3$`마감(목)` <- ifelse(((df3$`마감(목)` >= 0)&(df3$`마감(목)` < 530)),df3$`마감(목)`+2400,df3$`마감(목)`)
df3$`마감(금)` <- ifelse(((df3$`마감(금)` >= 0)&(df3$`마감(금)` < 530)),df3$`마감(금)`+2400,df3$`마감(금)`)
df3$`마감(토)` <- ifelse(((df3$`마감(토)` >= 0)&(df3$`마감(토)` < 530)),df3$`마감(토)`+2400,df3$`마감(토)`)
df3$`마감(일)` <- ifelse(((df3$`마감(일)` >= 0)&(df3$`마감(일)` < 530)),df3$`마감(일)`+2400,df3$`마감(일)`)
df3$`마감(공휴일)` <- ifelse(((df3$`마감(공휴일)` >= 0)&(df3$`마감(공휴일)` < 530)),df3$`마감(공휴일)`+2400,df3$`마감(공휴일)`)
View(df3)
```

* 야간운영정보 저장하기
* 강효은/차수빈/최은빈 학생의 방식을 활용하였습니다.
```{r}
# 괄호의 경우 이미 선언된 변수가 아니면 함수로 인식되서 일단 언더바 처리했습니다.
df3$야간_월 <- ifelse(((df3$`마감(월)` >= 2030)&(df3$`마감(월)` <= 2929)),TRUE,FALSE)
df3$야간_화 <- ifelse(((df3$`마감(화)` >= 2030)&(df3$`마감(화)` <= 2929)),TRUE,FALSE)
df3$야간_수 <- ifelse(((df3$`마감(수)` >= 2030)&(df3$`마감(수)` <= 2929)),TRUE,FALSE)
df3$야간_목 <- ifelse(((df3$`마감(목)` >= 2030)&(df3$`마감(목)` <= 2929)),TRUE,FALSE)
df3$야간_금 <- ifelse(((df3$`마감(금)` >= 2030)&(df3$`마감(금)` <= 2929)),TRUE,FALSE)
df3$야간_토 <- ifelse(((df3$`마감(토)` >= 2030)&(df3$`마감(토)` <= 2929)),TRUE,FALSE)
df3$야간_일 <- ifelse(((df3$`마감(일)` >= 2030)&(df3$`마감(일)` <= 2929)),TRUE,FALSE)
df3$야간_공휴일 <- ifelse(((df3$`마감(공휴일)` >= 2030)&(df3$`마감(공휴일)` <= 2929)),TRUE,FALSE)

# 일요일과 공휴일의 경우 운영을 하지 않는 약국들도 있음 
# 운영시간이 NA이기 때문에 비교 연산의 결과 NA가 나온다.
# 해당 값들은 별도로 FALSE 처리를 해주어야 한다.
df3[which(is.na(df3$`시작(일)`)),"야간_일"] = FALSE
df3[which(is.na(df3$`시작(공휴일)`)),"야간_공휴일"] = FALSE
```


```{r}
View(df3)
```

```{r}
# 컬럼명 재설정
new_colname <- c("약국명","주소","대표전화","행정구","시작(월)","마감(월)","시작(화)","마감(화)","시작(수)","마감(수)","시작(목)","마감(목)","시작(금)","마감(금)","시작(토)","마감(토)","시작(일)","마감(일)","시작(공휴일)","마감(공휴일)","일요일운영","공휴일운영","야간운영(월)","야간운영(화)","야간운영(수)","야간운영(목)","야간운영(금)","야간운영(토)","야간운영(일)","야간운영(공휴일)")
colnames(df3) <- new_colname
View(df3)
```

### csv 파일로 내보내기
```{r}
write.csv(df3,"C:/waterbean/Ewha/comp/project/seoul_pharmacy_final.csv",
          row.names = FALSE)
```



