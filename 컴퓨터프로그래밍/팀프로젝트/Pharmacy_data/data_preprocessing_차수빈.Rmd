---
title: "Data_preprocessing"
output: word_document
---
* 해당 파일은 R 4.1.0 버전에서 작성되었습니다.

* Rmd 파일의 경우 data frame을 출력하면 너무 깨져서 data frame이 따로 출력되도록 하는 코드는 포함시키지 않았습니다. R 파일을 열어서 코드를 작동시키면 View()에 의해 data frame이 표 형태로 가독성 좋게 출력되오니, 이를 참고해 주세요:)

### 데이터 파일 읽기
* 위의 두 줄의 경우 제가 처음에 R 설치할 때 설정된 main 작업 경로랑 현재 작업 경로가 달라서 작업 경로 틀어준 코드라 빼셔도 됩니다.
```{r}
getwd() # 현재 작업 경로 확인하기
setwd("C:/waterbean/Ewha/comp/project") # 작업 경로 잡아주기

df1 <- read.csv("seoul_pharmacy.csv")
View(df1) # 스프레드시트 형태로 데이터를 보여줌
class(df1) # 읽어온 데이터 파일은 data.frame 형태임
```

### 주소에서 구만 선택하여 행정구 컬럼으로 저장하기
```{r}
addr_li<- strsplit(df1$주소,split = " ")
# 문자열 슬라이싱 결과 list 형태로 저장됨 
# -> 각각의 벡터 전체에서 두 번째 내부 원소가 구이다.

# 리스트의 경우 구성 벡터의 내부 원소에 접근하려면 [[]]을 이용하여야 함
# 각 벡터의 두 번째 요소에 접근하는 함수를 만들고, 각 행마다(각 벡터마다) 적용

search <- function(x){ # 두 번째 요소 찾기
  x[2]
}

df1$행정구 <- sapply(addr_li,search)
View(df1)
```

### 필요힌 정보만을 가져오기
* 가져와야 할 컬럼의 수 > 없앨 컬럼의 수
* 기존의 data frame에서 약국ID, 우편번호1/2, 병원경도/위도, 작업일시 컬럼 삭제
```{r}
df2 <- df1[,-c(1,21:25)]
View(df2)

# 보기 좋은 형태로 컬럼 순서 변경하기
df3 <- df2[,c(2,1,3,20,12,4,13,5,14,6,15,7,16,8,17,9,18,10,19,11)]
View(df3)

# 컬럼명 변경하기
new_colname <- c("약국명","주소","대표전화","행정구","진료시작(월)","진료마감(월)","진료시작(화)","진료마감(화)","진료시작(수)","진료마감(수)","진료시작(목)","진료마감(목)","진료시작(금)","진료마감(금)","진료시작(토)","진료마감(토)","진료시작(일)","진료마감(일)","진료시작(공휴일)","진료마감(공휴일)")
colnames(df3) <- new_colname
View(df3)
```

### 지역 선택하기
* 생각해보니 굳이 나눌 필요가...있나요...?
* 나중에 알고리즘 짤 때 사용자가 제공한 정보에 따라서 맞춰서 제공해주면 될 것 같다고 생각됩니다.

```{r}
gu <- c("동대문구","동작구","마포구","서대문구","서초구")
df4 <- df3[which(df3$행정구%in%gu),] 
# %in% : 벡터에서 해당 요소의 포함 여부 반환

View(df4)
```

# 새로운 정보 저장을 위한 컬럼 생성
### 1. 공휴일 운영 여부
```{r}
df4$공휴일 <- NA # 공휴일 컬럼을 NA로 초기화
df4[is.na(df4$`진료시작(공휴일)`),"공휴일"] <- FALSE
df4[is.na(df4$`진료마감(공휴일)`),"공휴일"] <- FALSE
df4[!is.na(df4$`진료시작(공휴일)`),"공휴일"] <- TRUE
df4[!is.na(df4$`진료마감(공휴일)`),"공휴일"] <- TRUE
View(df4)
```

### 2. 야간운영정보

```{r}
# 야간운영 정보 여부만을 저장하는 data frame을 생성하기
night <- data.frame(matrix(nrow = nrow(df4),ncol = 8)) # 빈 df 생성
day_night <- c("야간진료(월)","야간진료(화)","야간진료(수)","야간진료(목)","야간진료(금)","야간진료(토)","야간진료(일)","야간진료(공휴일)")
colnames(night) <- day_night

# 약국의 야간운영 정보를 확인하는 함수
# 주간 운영 시간대를 설정하고, 이 외의 시간대에 마감하는 약국은 야간운영을 하는 약국임을 이용

opened <- function(x){
  ifelse((700 <= x) && (x <= 2030),FALSE,TRUE)
}

# 각 약국의 각 요일에 대한 야간운영정보 확인
night$`야간진료(월)` <- sapply(df4$`진료마감(월)`,opened)
night$`야간진료(화)` <- sapply(df4$`진료마감(화)`,opened)
night$`야간진료(수)` <- sapply(df4$`진료마감(수)`,opened)
night$`야간진료(목)` <- sapply(df4$`진료마감(목)`,opened)
night$`야간진료(금)` <- sapply(df4$`진료마감(금)`,opened)
night$`야간진료(토)` <- sapply(df4$`진료마감(토)`,opened)
night$`야간진료(일)` <- sapply(df4$`진료마감(일)`,opened)
night$`야간진료(공휴일)` <- sapply(df4$`진료마감(공휴일)`,opened)

# 약국 정보가 저장되어 있는 원래의 dataframe의 오른쪽에 열 방향으로 합치기
df4 <- cbind(df4,night)
View(df4)
```

# csv 파일로 내보내기
* 파일 경로는 각자의 경로에 맞게 재설정하셔야 합니다!
* 파일이름 맨 뒤에 자신이 맡은 구 영역 번호를 붙여주세요
  Ex> 1~5번 구이면 1번, 6~10번 구이면 2번 ... 
* 파일 경로 복사 시 '\'를 '/'로 바꿔주셔야 합니다.
* 저희는 행의 index 번호가 필요 없습니다. 따라서, row.names = TRUE 옵션을 사용하여 행 번호 index를 날려주세요:)

```{r}
write.csv(df4,"C:/waterbean/Ewha/comp/project/seoul_pharmacy_3.csv",
          row.names = FALSE)
```











